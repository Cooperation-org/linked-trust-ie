var express = require("express");
var router = express.Router();
const { exec, spawn } = require("node:child_process");

router.post("/", function(req, res, next) {
  const body = req.body;
  console.log(body.completedJobsArray);
  const cid = body.completedJobsArray;

  exec("bash bacalhau.sh " + cid, error => {
    if (error) {
      console.log(`error: ${error.message}`);
      return;
    }
  });

  setTimeout(() => {
    let root = require("../wasm_results/combined_results/outputs/root.json");
    res.send("The merkle root generated by Bacalhau is: " + root);
  }, 30000);
});

module.exports = router;
